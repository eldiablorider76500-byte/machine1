<script>
  // -----------------------------
  // VARIABLES GLOBALES
  // -----------------------------
  let isSpinning = false;
  let spinCount = 0;

  // alternances
  let toggle70 = true;   // pistolet / cygne
  let toggle260 = true;  // moto / loup

  // prochain petit lot entre 15 et 20 tours
  let nextSmallRewardAt = getRandomInt(15, 20);

  // Exemple de symboles sur tes rouleaux (adapte si besoin)
  const symbols = [
    "donut",
    "confetti",
    "toffu",
    "pistolet",
    "cygne",
    "moto",
    "loup"
  ];

  // -----------------------------
  // LANCEMENT DU SPIN
  // -----------------------------
  function startSpin() {
    if (isSpinning) return;
    isSpinning = true;

    // ðŸ” ici tu mets ton code dâ€™animation des rouleaux
    // par exemple : randomiser les symboles, lancer les transitions, etc.

    // Exemple simple (Ã  adapter Ã  ton code existant) :
    spinReels();

    // â± quand lâ€™animation est finie, on appelle endSpin()
    // adapte le timeout Ã  la durÃ©e rÃ©elle de ton spin
    setTimeout(() => {
      endSpin();
    }, 2000);
  }

  // -----------------------------
  // ANIMATION DES ROULEAUX (exemple)
  // -----------------------------
  function spinReels() {
    // Ici tu peux garder TON code pour gÃ©rer les 3 colonnes
    // Je mets juste un exemple gÃ©nÃ©rique :

    const reels = document.querySelectorAll(".reel");
    reels.forEach((reel) => {
      const randomSymbol =
        symbols[Math.floor(Math.random() * symbols.length)];
      reel.setAttribute("data-symbol", randomSymbol);
      reel.textContent = randomSymbol; // Ã  remplacer par tes emojis/images
    });
  }

  // -----------------------------
  // FIN DU SPIN
  // -----------------------------
  function endSpin() {
    // Ici, si tu as une logique de gains normale
    // basÃ©e sur lâ€™alignement des symboles, tu la gardes.

    // Ensuite on gÃ¨re tes tours "scriptÃ©s"
    handleRewardsLogic();

    isSpinning = false;
  }

  // -----------------------------
  // LOGIQUE DES RÃ‰COMPENSES
  // -----------------------------
  function handleRewardsLogic() {
    spinCount++;

    console.log("Tour nÂ°", spinCount);

    // 1ï¸âƒ£ 200e tour : MOTO OBLIGATOIRE
    if (spinCount === 200) {
      giveReward("moto");
      return;
    }

    // 2ï¸âƒ£ AprÃ¨s 200, tous les 260 tours : MOTO / LOUP en alternance
    // (260, 520, 780, etc.)
    if (spinCount > 200 && spinCount % 260 === 0) {
      if (toggle260) {
        giveReward("moto");
      } else {
        giveReward("loup");
      }
      toggle260 = !toggle260;
      return;
    }

    // 3ï¸âƒ£ Tous les 70 tours : PISTOLET / CYGNE en alternance
    if (spinCount % 70 === 0) {
      if (toggle70) {
        giveReward("pistolet");
      } else {
        giveReward("cygne");
      }
      toggle70 = !toggle70;
      return;
    }

    // 4ï¸âƒ£ Tous les 15â€“20 tours : PETIT LOT
    if (spinCount === nextSmallRewardAt) {
      giveSmallReward();
      // On redÃ©finit le prochain petit lot
      nextSmallRewardAt = spinCount + getRandomInt(15, 20);
      return;
    }

    // Sinon, rien de "scriptÃ©" sur ce tour
    console.log("Pas de lot programmÃ© sur ce tour.");
  }

  // -----------------------------
  // PETITS LOTS (donuts / confettis / toffu)
  // -----------------------------
  function giveSmallReward() {
    const smallRewards = ["donut", "confetti", "toffu"];
    const reward =
      smallRewards[Math.floor(Math.random() * smallRewards.length)];
    giveReward(reward);
  }

  // -----------------------------
  // FONCTION GÃ‰NÃ‰RIQUE Dâ€™AFFICHAGE DE LOT
  // -----------------------------
  function giveReward(name) {
    console.log("ðŸŽ‰ LOT GAGNÃ‰ :", name);

    // Ici tu mets :
    // - ton popup
    // - ton overlay TikTok
    // - tes animations
    // - lâ€™ajout de coins, etc.

    const popup = document.querySelector(".reward-popup");
    const rewardNameEl = document.querySelector(".reward-name");

    if (popup && rewardNameEl) {
      rewardNameEl.textContent = name;
      popup.classList.add("visible");

      setTimeout(() => {
        popup.classList.remove("visible");
      }, 2000);
    }
  }

  // -----------------------------
  // RANDOM INT INCLUSIF
  // -----------------------------
  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return (
      Math.floor(Math.random() * (max - min + 1)) + min
    );
  }

  // -----------------------------
  // BOUTON SPIN (exemple)
  // -----------------------------
  document.addEventListener("DOMContentLoaded", () => {
    const spinBtn = document.querySelector(".spin-button");
    if (spinBtn) {
      spinBtn.addEventListener("click", startSpin);
    }
  });
</script>
