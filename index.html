<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Slot 3B TikTok</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d3350 0, #050811 55%, #02030a 100%);
      color:#fff;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .machine {
      width:90vw;
      max-width:1300px;
      height:90vh;
      max-height:750px;
      border-radius:40px;
      padding:30px;
      background:linear-gradient(120deg,#271235,#120616 40%,#1c1634 100%);
      box-shadow:0 0 40px rgba(255,0,255,0.15), 0 0 80px rgba(255,128,0,0.14);
      display:flex;
      flex-direction:column;
      position:relative;
    }

    .title {
      text-align:center;
      font-size:40px;
      font-weight:800;
      letter-spacing:3px;
      text-transform:uppercase;
      color:#ffd54f;
      text-shadow:0 0 10px rgba(255,215,0,0.8), 0 0 18px #ff0080;
      margin-bottom:10px;
    }

    .subtitle {
      text-align:center;
      margin-bottom:20px;
      color:#f7e8ff;
      font-size:14px;
      opacity:0.85;
    }

    .top-info {
      display:flex;
      justify-content:space-between;
      padding:0 20px;
      margin-bottom:12px;
      font-size:14px;
      color:#d6d0ff;
    }

    /* REELS */
    .reels-box {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:20px;
    }

    .reels-frame {
      width:900px;
      height:330px;
      padding:18px;
      border-radius:22px;
      background:linear-gradient(180deg,#ff00b8,#ff9100);
      box-shadow:0 0 25px rgba(255,64,129,0.6);
    }

    .reels-inner {
      background:radial-gradient(circle at top,#121b33,#050814 80%);
      height:100%;
      border-radius:18px;
      display:flex;
      justify-content:space-evenly;
      align-items:center;
      padding:10px 15px;
    }

    .reel {
      width:150px;
      height:100%;
      background:linear-gradient(#161f32,#080a12);
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:inset 0 0 12px rgba(0,0,0,0.8);
      overflow:hidden;
    }

    .reel img {
      width:80%;
      object-fit:contain;
      filter:drop-shadow(0 0 10px rgba(0,0,0,0.8));
    }

    /* PANNEAU DROITE */
    .right-panel {
      position:absolute;
      right:30px;
      top:150px;
      width:360px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .box {
      background:rgba(0,0,0,0.35);
      border-radius:12px;
      padding:12px;
      font-size:14px;
      box-shadow:inset 0 0 8px rgba(0,0,0,0.4);
    }

    .box-title {
      font-weight:700;
      color:#ffdd7d;
      margin-bottom:6px;
    }

    .controls {
      display:flex;
      gap:10px;
      margin-top:15px;
      width:100%;
      justify-content:center;
    }

    .btn {
      padding:10px 20px;
      border-radius:999px;
      font-size:16px;
      font-weight:700;
      border:none;
      cursor:pointer;
      transition:0.15s;
    }

    .btn-manual { background:#ffb300; color:#320000; }
    .btn-spin { background:#00e676; color:#042c10; }

    .btn:active { transform:scale(0.96); }
  </style>
</head>
<body>
<div class="machine">

  <div class="title">SLOT 3B TIKTOK</div>
  <div class="subtitle">4 mêmes cadeaux = gain • Loup = GIGA WIN • Moto = MEGA WIN</div>

  <div class="top-info">
    <div>Joueur : <span id="playerNameDisplay">-</span> • Cadeau : <span id="giftCoinsDisplay">0</span> pièces • Tours restants : <span id="spinsLeftDisplay">0</span></div>
    <div>Tours joués : <span id="totalSpinsDisplay">0</span></div>
  </div>

  <div class="reels-box">
    <div class="reels-frame">
      <div class="reels-inner">
        <div class="reel"><img id="reel0"></div>
        <div class="reel"><img id="reel1"></div>
        <div class="reel"><img id="reel2"></div>
        <div class="reel"><img id="reel3"></div>
      </div>
    </div>
  </div>

  <div class="right-panel">
    <div class="box">
      <div class="box-title">File d'attente</div>
      <div id="queueCount">Aucun joueur</div>
    </div>

    <div class="box">
      <div class="box-title">Gagnants (session)</div>
      <div id="winnersList">Aucun gagnant</div>
    </div>

    <div class="box">
      <div class="box-title">Statut TikTok</div>
      <div id="tiktokStatus">Déconnecté</div>
    </div>
  </div>

  <div style="width:100%;display:flex;justify-content:center;margin-top:10px;">
    <input id="playerName" placeholder="Pseudo..." style="width:160px;padding:6px;border-radius:8px;border:none;">
    <input id="giftCoins" placeholder="ex : 99" type="number" style="width:120px;margin-left:8px;padding:6px;border-radius:8px;border:none;">
  </div>

  <div class="controls">
    <button class="btn btn-manual" id="addManualBtn">AJOUTER (MANUEL)</button>
    <button class="btn btn-spin" id="spinBtn" disabled>SPIN</button>
  </div>
</div>
<script>
/* -------------------------------------------
   CONFIGURATION DES IMAGES (TES CADEAUX)
-------------------------------------------- */
const IMAGE_PATH = "Cadeaux/"; // ton dossier sur GitHub

// liste EXACTE des fichiers (comme sur ton screenshot)
const SYMBOLS = [
  "IMG-20251120-WA0017.jpg",
  "IMG-20251120-WA0018.jpg",
  "IMG-20251120-WA0019.jpg",
  "IMG-20251120-WA0020.jpg",
  "IMG-20251120-WA0021.jpg",
  "IMG-20251120-WA0022.jpg",
  "IMG-20251120-WA0023.jpg",
  "IMG-20251120-WA0024.jpg",
  "IMG-20251120-WA0025.jpg",
  "IMG-20251120-WA0026.jpg",
  "IMG-20251120-WA0027.jpg",
  "IMG-20251120-WA0028.jpg",
  "IMG-20251120-WA0029.jpg",
  "IMG-20251120-WA0030.jpg",
  "IMG-20251120-WA0031.jpg",
  "IMG-20251120-WA0032.jpg",
  "IMG-20251120-WA0033.jpg",
  "IMG-20251120-WA0034.jpg",
  "IMG-20251120-WA0035.jpg",
  "IMG-20251120-WA0036.jpg",
  "IMG-20251120-WA0037.jpg",
  "IMG-20251120-WA0042.jpg"
];

// pour tirer un symbole au hasard
function randomSymbol() {
  const file = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
  return IMAGE_PATH + file;
}

/* -------------------------------------------
   INITIALISATION DES REELS (IMAGES AU DÉMARRAGE)
-------------------------------------------- */

const reels = [
  document.getElementById("reel0"),
  document.getElementById("reel1"),
  document.getElementById("reel2"),
  document.getElementById("reel3")
];

// au démarrage → met une image aléatoire
function initReels() {
  for (let i = 0; i < reels.length; i++) {
    reels[i].src = randomSymbol();
  }
}

initReels();
<script>
/* -------------------------------------------
   GESTION DES TOURS, FILE D'ATTENTE & JOUEUR
-------------------------------------------- */

// file d'attente : joueurs qui attendent leur tour
let queue = [];

// joueur actif
let currentPlayer = null;

// compteurs globaux
let spinsLeft = 0;
let totalSpins = 0;

// mise à jour de l'affichage en haut
function updateStatus() {
  document.getElementById("playerNameDisplay").textContent =
    currentPlayer ? currentPlayer.name : "-";

  document.getElementById("giftCoinsDisplay").textContent =
    currentPlayer ? currentPlayer.coins : 0;

  document.getElementById("spinsLeftDisplay").textContent = spinsLeft;
  document.getElementById("totalSpinsDisplay").textContent = totalSpins;
}

/* -------------------------------------------
   AJOUTER UN JOUEUR (MANUEL)
-------------------------------------------- */

document.getElementById("addManualBtn").addEventListener("click", () => {
  const name = document.getElementById("playerName").value.trim();
  const coins = parseInt(document.getElementById("giftCoins").value);

  if (!name || isNaN(coins) || coins <= 0) {
    alert("Pseudo ou pièces invalides.");
    return;
  }

  // calcul des tours selon la règle
  const spins = calcSpins(coins);
  if (spins <= 0) {
    alert("Minimum 49 pièces !");
    return;
  }

  queue.push({ name, coins, spins });
  updateQueueDisplay();

  if (!currentPlayer) nextPlayer();
});

/* règle des tours */
function calcSpins(coins) {
  if (coins >= 2999) return 70;
  if (coins >= 299) return 7;
  if (coins >= 99) return 3;
  if (coins >= 49) return 1;
  return 0;
}

/* -------------------------------------------
   AFFICHAGE DE LA FILE D'ATTENTE
-------------------------------------------- */

function updateQueueDisplay() {
  const box = document.getElementById("queueCount");
  if (queue.length === 0) {
    box.textContent = "Aucun joueur";
  } else {
    box.textContent = queue.map(p => `${p.name} (${p.spins} tours)`).join("<br>");
  }
}

/* -------------------------------------------
   PASSER AU JOUEUR SUIVANT
-------------------------------------------- */

function nextPlayer() {
  if (queue.length === 0) {
    currentPlayer = null;
    spinsLeft = 0;
    updateStatus();
    document.getElementById("spinBtn").disabled = true;
    return;
  }

  currentPlayer = queue.shift();
  spinsLeft = currentPlayer.spins;
  updateQueueDisplay();
  updateStatus();
  document.getElementById("spinBtn").disabled = false;
}

/* -------------------------------------------
   SPIN → CONSOMME UN TOUR
-------------------------------------------- */

document.getElementById("spinBtn").addEventListener("click", () => {
  if (spinsLeft <= 0 || !currentPlayer) return;

  spinsLeft--;
  totalSpins++;
  updateStatus();

  // animation des rouleaux
  spinReels(() => {
    // FIN DU SPIN
    if (spinsLeft <= 0) nextPlayer();
  });
});
/* -------------------------------------------
   ANIMATION DES ROULEAUX
-------------------------------------------- */
function spinReels(callback) {
  let stopped = 0;

  for (let i = 0; i < reels.length; i++) {
    const reel = reels[i];

    // random shuffle
    const interval = setInterval(() => {
      reel.src = randomSymbol();
    }, 80);

    // stop at different delays
    setTimeout(() => {
      clearInterval(interval);
      reel.src = randomSymbol(); // image finale
      stopped++;
      if (stopped === reels.length) callback();
    }, 700 + (i * 350));
  }
}

/* -------------------------------------------
   RÉCEPTION AUTOMATIQUE DES CADEAUX
-------------------------------------------- */
let socket = new WebSocket("ws://localhost:8080");

socket.onopen = () => {
  document.getElementById("tiktokStatus").textContent = "Connecté au serveur ✔";
};

socket.onclose = () => {
  document.getElementById("tiktokStatus").textContent = "Déconnecté ❌";
};

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);

  /* statut TikTok */
  if (data.type === "status") {
    document.getElementById("tiktokStatus").textContent =
      data.connected ? "Connecté au LIVE TikTok ✔" : "Déconnecté du LIVE ❌";
  }

  /* cadeau reçu */
  if (data.type === "gift") {

    const spins = calcSpins(data.coins);
    if (spins <= 0) return;

    queue.push({
      name: data.user,
      coins: data.coins,
      spins: spins
    });

    updateQueueDisplay();

    if (!currentPlayer) nextPlayer();
  }
};

/* -------------------------------------------
   PETIT EXTRA : AJOUTER UN GAGNANT
-------------------------------------------- */
function addWinner(symbol) {
  const box = document.getElementById("winnersList");

  if (box.textContent === "Aucun gagnant") {
    box.textContent = `${symbol}`;
  } else {
    box.innerHTML += `<br>${symbol}`;
  }
}
</script>
</body>
</html>
